(window.webpackJsonp=window.webpackJsonp||[]).push([[5],{"+F2W":function(e,t,n){"use strict";var i={props:{state:{type:Boolean,default:!1},title:{type:String,default:"Подтвердите действие"},message:{type:String,required:!0},okMessage:{type:String,default:"ОК"},cancelMessage:{type:String,default:"Отмена"}},methods:{onConfirm:function(){this.$emit("confirm")},onCancel:function(){this.$emit("cancel")}}},o=(n("dXLZ"),n("KHd+")),a=Object(o.a)(i,(function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",[n("v-dialog",{attrs:{persistent:"",width:"500"},model:{value:e.state,callback:function(t){e.state=t},expression:"state"}},[n("v-card",[n("v-card-title",{staticClass:"headline blue darken-1 justify-content-between"},[n("span",{staticClass:"white--text"},[e._v(e._s(e.title))]),e._v(" "),n("v-btn",{staticClass:"float-right",attrs:{icon:"",text:""}},[n("v-icon",{attrs:{color:"white"},on:{click:e.onCancel}},[e._v("\n                        mdi-close\n                    ")])],1)],1),e._v(" "),n("v-card-text",{staticClass:"modal-text"},[e._v("\n                "+e._s(e.message)+"\n            ")]),e._v(" "),n("v-divider"),e._v(" "),n("v-card-actions",[n("v-spacer"),e._v(" "),n("v-btn",{attrs:{text:""},on:{click:e.onCancel}},[e._v("\n                    "+e._s(e.cancelMessage)+"\n                ")]),e._v(" "),n("v-btn",{attrs:{color:"success",text:""},on:{click:e.onConfirm}},[e._v("\n                    "+e._s(e.okMessage)+"\n                    "),n("v-icon",[e._v("mdi-check")])],1)],1)],1)],1)],1)}),[],!1,null,"2adaa561",null);t.a=a.exports},E1z0:function(e,t,n){(e.exports=n("I1BE")(!1)).push([e.i,".d-flex[data-v-3781b043]{padding:10px}.subject__select[data-v-3781b043]{padding-top:0!important;margin-top:-2px!important;margin-left:10px}.change-photo[data-v-3781b043]{margin-top:15px}.button-container[data-v-3781b043]{margin:10px;max-width:300px}p[data-v-3781b043]{font-size:16px}",""])},F3ox:function(e,t,n){var i=n("toHN");"string"==typeof i&&(i=[[e.i,i,""]]);var o={hmr:!0,transform:void 0,insertInto:void 0};n("aET+")(i,o);i.locals&&(e.exports=i.locals)},HfdP:function(e,t,n){"use strict";n("Jzsf")},Jzsf:function(e,t,n){var i=n("nSvg");"string"==typeof i&&(i=[[e.i,i,""]]);var o={hmr:!0,transform:void 0,insertInto:void 0};n("aET+")(i,o);i.locals&&(e.exports=i.locals)},L8FV:function(e,t,n){var i=n("P2eM");"string"==typeof i&&(i=[[e.i,i,""]]);var o={hmr:!0,transform:void 0,insertInto:void 0};n("aET+")(i,o);i.locals&&(e.exports=i.locals)},P2eM:function(e,t,n){(e.exports=n("I1BE")(!1)).push([e.i,".modal-text[data-v-b396b834]{padding:30px!important}",""])},TiMU:function(e,t,n){"use strict";var i={props:{state:{type:Boolean,default:!1},title:{type:String,default:"Отправка сообщения"},messageTitle:{type:String,default:"Заголовок сообщения"},messageBody:{type:String,default:"Текст сообщения"}},data:function(){return{title_:"",body:""}},methods:{onCancel:function(){this.$emit("modalClosed"),this.clearData()},onSend:function(){this.$emit("sendMessage",{title:this.title_,body:this.body}),this.clearData()},clearData:function(){this.title_="",this.body=""}}},o=n("KHd+"),a=Object(o.a)(i,(function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("v-dialog",{attrs:{"max-width":"600",persistent:""},model:{value:e.state,callback:function(t){e.state=t},expression:"state"}},[n("v-card",[n("v-card-title",{staticClass:"headline blue darken-1 justify-content-between"},[n("span",{staticClass:"white--text"},[e._v(e._s(e.title))]),e._v(" "),n("v-btn",{staticClass:"float-right",attrs:{icon:"",text:""}},[n("v-icon",{attrs:{color:"white"},on:{click:e.onCancel}},[e._v("\n                    mdi-close\n                ")])],1)],1),e._v(" "),n("v-card-text",[n("v-text-field",{attrs:{label:e.messageTitle},model:{value:e.title_,callback:function(t){e.title_=t},expression:"title_"}}),e._v(" "),n("v-textarea",{attrs:{label:e.messageBody,rows:"5","auto-grow":""},model:{value:e.body,callback:function(t){e.body=t},expression:"body"}})],1),e._v(" "),n("v-divider"),e._v(" "),n("v-card-actions",[n("v-spacer"),e._v(" "),n("v-btn",{attrs:{text:""},on:{click:e.onCancel}},[e._v("Отмена")]),e._v(" "),n("v-btn",{attrs:{text:"",color:"success"},on:{click:e.onSend}},[e._v("Отправить")])],1)],1)],1)}),[],!1,null,"1b408430",null);t.a=a.exports},bUEj:function(e,t,n){"use strict";n.r(t);var i=n("o0o1"),o=n.n(i),a=n("+F2W"),c=n("TiMU"),s=n("wd/R"),r=n.n(s),l=n("wq7B"),d=n("1jYr"),u=n("6cC8"),v=n("BWV3"),p=n("uzyW");function f(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,i)}return n}function _(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?f(Object(n),!0).forEach((function(t){m(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):f(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function m(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function h(e,t,n,i,o,a,c){try{var s=e[a](c),r=s.value}catch(e){return void n(e)}s.done?t(r):Promise.resolve(r).then(i,o)}function b(e){return function(){var t=this,n=arguments;return new Promise((function(i,o){var a=e.apply(t,n);function c(e){h(a,i,o,c,s,"next",e)}function s(e){h(a,i,o,c,s,"throw",e)}c(void 0)}))}}String.prototype.replaceAll=function(e,t){return this.split(e).join(t)};var x={data:function(){return{valid:!0,calendarModal:!1,picker:!0,isUnique:!0,loading:!1,errorMessage:"",connection:{service_id:null,address:"",personal_account:null,price:0,date_start:r()().format("YYYY-MM-DD"),month_price:0,trademark:"",client_id:null,company_id:null},personalAccountRules:[function(e){return!!e||"Введите лицевой счет"}],serviceRules:[function(e){return!!e||"Выберите услугу!"}]}},props:{state:{type:Boolean,default:!1}},methods:{setData:function(){this.setTrademark(),this.setPrice()},connectService:function(){var e=this;return b(o.a.mark((function t(){var n,i;return o.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return e.loading=!0,e.connection.client_id=e.$route.params.userId,e.connection.personal_account=e.connection.personal_account.replaceAll(" ",""),e.connection.balance=-1*e.connection.month_price,e.connection.user_id=e.$store.getters.user.id,t.next=7,e.$store.dispatch(u.a.ADD_CONNECTION,e.connection);case 7:return n=e.services.filter((function(t){return t.id===e.connection.service_id}))[0].name,i={title:"Внимание",body:'Вы были подключены к услуге "'.concat(n,'"')},t.next=11,e.sendMessage(i);case 11:if(!(e.connection.month_price>0)){t.next=15;break}return i.body="С Вашего баланса произошло списание ".concat(e.connection.month_price,' тг по услуге "').concat(n,'!"'),t.next=15,e.sendMessage(i);case 15:e.$emit("connect"),e.loading=!1;case 17:case"end":return t.stop()}}),t)})))()},sendMessage:function(e){var t=this;return b(o.a.mark((function n(){var i;return o.a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return i=_(_({},e),{},{client_id:t.connection.client_id,user_id:1}),n.prev=1,n.next=4,Object(p.k)(i);case 4:n.next=9;break;case 6:n.prev=6,n.t0=n.catch(1),console.log(n.t0);case 9:return n.prev=9,t.showSendModal=!1,n.finish(9);case 12:case"end":return n.stop()}}),n,null,[[1,6,9,12]])})))()},checkDuplicates:function(){var e=this;return b(o.a.mark((function t(){var n,i;return o.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(e.connection.personal_account){t.next=2;break}return t.abrupt("return");case 2:return n=e.connection.personal_account.replaceAll(" ",""),t.next=5,Object(d.j)(n);case 5:i=t.sent,e.errorMessage=1===i?"Данный лицевой счет уже используется!":"";case 7:case"end":return t.stop()}}),t)})))()},setTrademark:function(){var e=this,t="";this.connection.service_id&&(t=this.services.find((function(t){return t.id===e.connection.service_id})).trademark_default);this.$set(this.connection,"trademark",t)},setPrice:function(){var e=this,t="";this.connection.service_id&&(t=this.services.find((function(t){return t.id===e.connection.service_id})).price);this.$set(this.connection,"price",t)}},computed:{services:function(){return this.$store.getters[l.a.NORMAL_SERVICES]},correctDate:function(){var e=this.connection.date_start;return e?e=(e=e.toString()).split("-").reverse().join("."):null},companies:function(){return this.$store.getters.COMPANIES}}},g=(n("f1/F"),n("KHd+")),y=Object(g.a)(x,(function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("v-dialog",{attrs:{"max-width":"800",persistent:""},model:{value:e.state,callback:function(t){e.state=t},expression:"state"}},[n("v-card",[n("v-card-title",{staticClass:"headline blue darken-1 justify-content-between"},[n("span",{staticClass:"white--text"},[e._v("Подключение новой услуги")]),e._v(" "),n("v-btn",{staticClass:"float-right",attrs:{icon:"",text:""}},[n("v-icon",{attrs:{color:"white"},on:{click:function(t){return e.$emit("cancel")}}},[e._v("\n                    mdi-close\n                ")])],1)],1),e._v(" "),n("v-card-text",{staticClass:"modal-text"},[e.loading?e._e():n("v-form",{model:{value:e.valid,callback:function(t){e.valid=t},expression:"valid"}},[n("v-select",{attrs:{label:"Услуга",rules:e.serviceRules,items:e.services,"item-text":"name","item-value":"id"},on:{change:e.setData},model:{value:e.connection.service_id,callback:function(t){e.$set(e.connection,"service_id",t)},expression:"connection.service_id"}}),e._v(" "),n("v-select",{attrs:{label:"Компания",items:e.companies,"item-value":"id","item-text":"name"},model:{value:e.connection.company_id,callback:function(t){e.$set(e.connection,"company_id",t)},expression:"connection.company_id"}}),e._v(" "),n("v-text-field",{attrs:{label:"Торговое наименование"},model:{value:e.connection.trademark,callback:function(t){e.$set(e.connection,"trademark",t)},expression:"connection.trademark"}}),e._v(" "),n("v-text-field",{attrs:{label:"Адрес"},model:{value:e.connection.address,callback:function(t){e.$set(e.connection,"address",t)},expression:"connection.address"}}),e._v(" "),n("v-text-field",{directives:[{name:"mask",rawName:"v-mask",value:"## ## ##",expression:"'## ## ##'"}],attrs:{label:"Лицевой счет",rules:e.personalAccountRules,"error-messages":e.errorMessage},on:{blur:e.checkDuplicates},model:{value:e.connection.personal_account,callback:function(t){e.$set(e.connection,"personal_account",t)},expression:"connection.personal_account"}}),e._v(" "),n("v-text-field",{attrs:{type:"number",prefix:"₸",label:"Тариф"},model:{value:e.connection.price,callback:function(t){e.$set(e.connection,"price",t)},expression:"connection.price"}}),e._v(" "),n("v-dialog",{ref:"dialog",attrs:{"return-value":e.connection.date_start,persistent:"",width:"290px"},on:{"update:returnValue":function(t){return e.$set(e.connection,"date_start",t)},"update:return-value":function(t){return e.$set(e.connection,"date_start",t)}},scopedSlots:e._u([{key:"activator",fn:function(t){var i=t.on;return[n("v-text-field",e._g({attrs:{label:"Дата начала",readonly:""},model:{value:e.correctDate,callback:function(t){e.correctDate=t},expression:"correctDate"}},i))]}}],null,!1,1413910340),model:{value:e.calendarModal,callback:function(t){e.calendarModal=t},expression:"calendarModal"}},[e._v(" "),n("v-date-picker",{attrs:{locale:"ru","first-day-of-week":"1",scrollable:""},model:{value:e.connection.date_start,callback:function(t){e.$set(e.connection,"date_start",t)},expression:"connection.date_start"}},[n("v-spacer"),e._v(" "),n("v-btn",{attrs:{text:"",color:"primary"},on:{click:function(t){e.calendarModal=!1}}},[e._v("Отмена")]),e._v(" "),n("v-btn",{attrs:{text:"",color:"primary"},on:{click:function(t){return e.$refs.dialog.save(e.connection.date_start)}}},[e._v("OK")])],1)],1),e._v(" "),n("v-text-field",{attrs:{prefix:"₸",type:"number",label:"Стоимость на месяц"},model:{value:e.connection.month_price,callback:function(t){e.$set(e.connection,"month_price",e._n(t))},expression:"connection.month_price"}})],1),e._v(" "),n("v-divider")],1),e._v(" "),n("v-progress-linear",{attrs:{indeterminate:"",active:e.loading,color:"green",absolute:"",bottom:""}}),e._v(" "),e.loading?e._e():n("v-card-actions",[n("v-spacer"),e._v(" "),n("v-btn",{attrs:{text:""},on:{click:function(t){return e.$emit("cancel")}}},[e._v("Отмена")]),e._v(" "),n("v-btn",{attrs:{text:"",color:"success",disabled:!e.valid},on:{click:e.connectService}},[e._v("Подключить")])],1)],1)],1)}),[],!1,null,"b396b834",null).exports,C=n("hlRy"),k=n("ootA");function w(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,i)}return n}function M(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?w(Object(n),!0).forEach((function(t){S(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):w(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function S(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function j(e,t,n,i,o,a,c){try{var s=e[a](c),r=s.value}catch(e){return void n(e)}s.done?t(r):Promise.resolve(r).then(i,o)}function O(e){return function(){var t=this,n=arguments;return new Promise((function(i,o){var a=e.apply(t,n);function c(e){j(a,i,o,c,s,"next",e)}function s(e){j(a,i,o,c,s,"throw",e)}c(void 0)}))}}var P={components:{MessageModal:c.a,ConnectServiceModal:y,VTextField:C.a,ConfirmationModal:a.a},mounted:function(){this.addFields=Object.values(this.client.additional_fields)},data:function(){return{connectKey:0,dummy:Date.now(),deleteModal:!1,valid:!0,connectModal:!1,showSendModal:!1,editMode:!1,newPhoto:"",addFields:[],nameRules:[function(e){return!!e||"Требуется ввести контрагента"}],phoneRules:[function(e){return!!e||"Требуется ввести телефон"}]}},computed:{user:function(){return this.$store.getters.user},genders:function(){return this.$store.getters.GENDERS},languages:function(){return this.$store.getters.LANGUAGES},phoneInputs:function(){if(0===this.client.phones.length)return[{component:C.a}];var e=[];return this.client.phones.forEach((function(t){e.push({component:C.a})})),e},activeFields:function(){return this.$store.getters.active_fields},isPhysical:function(){return 1==+this.client.client_type}},props:{client:{type:Object,required:!0},subjects:{type:Array,required:!0}},methods:{toggleEdit:function(){this.editMode=!0,this.$emit("editToggled",{})},getDate:function(e){return"0000-00-00"!==e&&null!==e?new Date(e).toLocaleDateString():"Не указано"},saveUser:function(){var e=this;return O(o.a.mark((function t(){var n;return o.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n=M({},e.addFields),Object.keys(n).forEach((function(t,i){n[e.activeFields[i].alias]=n[i],delete n[t]})),e.client.additional_fields=JSON.stringify(M({},n)),e.client.phones=e.client.phones.filter((function(e){return!!e})).map((function(e){return e.replaceAll("-","")})),delete e.client.push_token,t.next=7,e.$store.dispatch(u.a.EDIT_CLIENT,{client:e.client,newPhoto:e.newPhoto});case 7:e.client=t.sent,e.newPhoto="",e.editMode=!1,e.$emit("saveToggled",e.client);case 11:case"end":return t.stop()}}),t)})))()},showConnectModal:function(){this.connectModal=!0},closeConnectModal:function(){this.connectKey++,this.connectModal=!1},onConnectModal:function(){this.connectKey++,this.connectModal=!1,Object(v.a)("Услуга была успешно подключена")},closeModal:function(){this.showSendModal=!1},deleteClient:function(){var e=this;return O(o.a.mark((function t(){return o.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,e.$store.dispatch(u.a.DELETE_CLIENT,e.client.id);case 2:return t.next=4,e.$router.push("/");case 4:case"end":return t.stop()}}),t)})))()},editUser:function(){this.editMode?(this.phoneInputs=[],this.saveUser()):this.toggleEdit()},addPhoneInput:function(){this.client.phones.push("")},choosePhoto:function(){this.$refs.photoInput.click()},uploadPhoto:function(e){var t=this;return O(o.a.mark((function n(){var i,a;return o.a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return i=e.target.files[0],n.next=3,Object(k.a)(i);case 3:a=n.sent,t.newPhoto=a.data;case 5:case"end":return n.stop()}}),n)})))()},sendMessage:function(e){var t=this;return O(o.a.mark((function n(){var i,a;return o.a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return i=M(M({},e),{},{client_id:t.client.id,user_id:1}),n.next=3,Object(p.k)(i);case 3:a=n.sent,console.log(a),t.showSendModal=!1,Object(v.a)("Сообщение отправлено");case 7:case"end":return n.stop()}}),n)})))()},showPushModal:function(){this.client.push_token?this.showSendModal=!0:Object(v.a)("Данный клиент не установил мобильное приложение: отправка пуш-уведомления невозможна","Ошибка","warning")}}},$=(n("vsCU"),Object(g.a)(P,(function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",[n("v-form",{model:{value:e.valid,callback:function(t){e.valid=t},expression:"valid"}},[n("v-row",[n("v-col",{attrs:{col:"4"}},[n("div",{staticClass:"d-flex"},[n("p",[n("span",{staticClass:"font-weight-black"},[e._v("СПО: ")]),e._v(" "),e.editMode?e._e():n("span",[e._v(e._s(e.client.type))])]),e._v(" "),e.editMode?n("v-select",{staticClass:"subject__select",attrs:{items:e.subjects,"item-text":"type","item-value":"id"},model:{value:e.client.client_type,callback:function(t){e.$set(e.client,"client_type",t)},expression:"client.client_type"}}):e._e()],1),e._v(" "),n("div",{staticClass:"d-flex"},[n("p",[n("span",{staticClass:"font-weight-black"},[e._v("Контрагент: ")]),e._v(" "),e.editMode?e._e():n("span",[e._v(e._s(e.client.name))])]),e._v(" "),e.editMode?n("v-text-field",{staticClass:"subject__select",attrs:{rules:e.nameRules},model:{value:e.client.name,callback:function(t){e.$set(e.client,"name",t)},expression:"client.name"}}):e._e()],1),e._v(" "),n("div",{staticClass:"d-flex"},[n("p",[n("span",{staticClass:"font-weight-black"},[e._v("Телефон:")])]),e._v(" "),n("p",{staticClass:"ml-2"},e._l(e.client.phones,(function(t,i){return e.editMode?e._e():n("span",{key:i},[e._v("\n                        "+e._s(t)),n("br")])})),0),e._v(" "),e.editMode?n("div",[e._l(e.phoneInputs,(function(t,i){return n(t.component,{directives:[{name:"mask",rawName:"v-mask",value:"#-###-###-##-##",expression:"'#-###-###-##-##'"}],key:i,tag:"component",staticClass:"subject__select",attrs:{rules:e.phoneRules,label:"Телефон","append-outer-icon":"mdi-plus"},on:{"click:append-outer":e.addPhoneInput},model:{value:e.client.phones[i],callback:function(t){e.$set(e.client.phones,i,t)},expression:"client.phones[index]"}})})),e._v(" "),e.phoneInputs.length>1?n("v-btn",{staticClass:"ml-2",attrs:{color:"primary"},on:{click:function(t){return e.client.phones.pop()}}},[e._v("\n                            Удалить поле\n                            "),n("v-icon",[e._v("mdi-delete")])],1):e._e()],2):e._e()]),e._v(" "),e.isPhysical?n("div",{staticClass:"d-flex"},[n("p",[n("span",{staticClass:"font-weight-black"},[e._v("Пол: ")]),e._v(" "),e.editMode?e._e():n("span",[e._v("\n                            "+e._s(e.genders.find((function(t){return t.id===e.client.gender})).gender)+"\n                        ")])]),e._v(" "),e.editMode?n("v-select",{staticClass:"subject__select",attrs:{items:e.genders,"item-text":"gender","item-value":"id"},model:{value:e.client.gender,callback:function(t){e.$set(e.client,"gender",t)},expression:"client.gender"}}):e._e()],1):e._e(),e._v(" "),e.isPhysical?n("div",{staticClass:"d-flex"},[n("p",[n("span",{staticClass:"font-weight-black"},[e._v("Дата рождения: ")]),e._v(" "),e.editMode?e._e():n("span",[e._v("\n                            "+e._s(e.getDate(e.client.birth_date))+"\n                        ")])]),e._v(" "),e.editMode?n("v-text-field",{attrs:{label:"Дата рождения",type:"date"},model:{value:e.client.birth_date,callback:function(t){e.$set(e.client,"birth_date",t)},expression:"client.birth_date"}}):e._e()],1):e._e(),e._v(" "),e.isPhysical?n("div",{staticClass:"d-flex"},[n("p",[n("span",{staticClass:"font-weight-black"},[e._v("Язык: ")]),e._v(" "),e.editMode?e._e():n("span",[e._v("\n                            "+e._s(e.languages.find((function(t){return t.id===e.client.lang})).lang)+"\n                        ")])]),e._v(" "),e.editMode?n("v-select",{staticClass:"subject__select",attrs:{items:e.languages,"item-text":"lang","item-value":"id"},model:{value:e.client.lang,callback:function(t){e.$set(e.client,"lang",t)},expression:"client.lang"}}):e._e()],1):e._e(),e._v(" "),n("div",{staticClass:"d-flex"},[n("p",[n("span",{staticClass:"font-weight-black"},[e._v("Комментарий: ")]),e._v(" "),e.editMode?e._e():n("span",[e._v(e._s(e.client.comment))])]),e._v(" "),e.editMode?n("v-textarea",{staticClass:"subject__select",attrs:{"auto-grow":""},model:{value:e.client.comment,callback:function(t){e.$set(e.client,"comment",t)},expression:"client.comment"}}):e._e()],1),e._v(" "),e._l(e.client.additional_fields,(function(t,i,o){return n("div",{staticClass:"d-flex"},[n("p",[n("span",{staticClass:"font-weight-black"},[e._v(e._s(i)+": ")]),e._v(" "),e.editMode?e._e():n("span",[e._v(e._s(t))])]),e._v(" "),e.editMode?n("v-textarea",{staticClass:"subject__select",attrs:{"auto-grow":""},model:{value:e.addFields[o],callback:function(t){e.$set(e.addFields,o,t)},expression:"addFields[index]"}}):e._e()],1)}))],2),e._v(" "),2!==e.user.role_id?n("v-col",{attrs:{cols:"4"}},[n("v-row",{attrs:{justify:"center"}},[n("div",[e.newPhoto||e.client.photo?n("v-avatar",{attrs:{size:"200",tile:""}},[n("v-img",{directives:[{name:"show",rawName:"v-show",value:!e.newPhoto,expression:"!newPhoto"}],attrs:{src:"../storage/"+e.client.photo+"?"+e.dummy,alt:"аватар",contain:""}}),e._v(" "),n("v-img",{directives:[{name:"show",rawName:"v-show",value:e.newPhoto,expression:"newPhoto"}],attrs:{src:"../storage/"+e.newPhoto+"?"+e.dummy,alt:"аватар",contain:""}})],1):e._e(),e._v(" "),n("div",[n("input",{ref:"photoInput",staticClass:"d-none",attrs:{type:"file",name:"photo"},on:{change:e.uploadPhoto}}),e._v(" "),e.editMode?n("v-btn",{staticClass:"change-photo",attrs:{block:"",color:"primary"},on:{click:e.choosePhoto}},[e._v("\n                                Сменить фото\n                            ")]):e._e()],1)],1)])],1):e._e(),e._v(" "),n("v-col",{attrs:{cols:"4"}},[n("div",{staticClass:"button-container"},[1===e.user.role_id||3===e.user.role_id?n("v-btn",{attrs:{block:"",color:e.editMode?"success":"primary",disabled:!e.valid},on:{click:e.editUser}},[e.editMode?n("span",[e._v("Сохранить")]):n("span",[e._v("Редактировать")]),e._v(" "),e.editMode?n("v-icon",[e._v("mdi-check")]):e._e()],1):e._e(),e._v(" "),e.editMode?n("v-btn",{staticClass:"mt-5",attrs:{block:"",color:"red darken-2"},on:{click:function(t){e.deleteModal=!0}}},[n("span",{staticClass:"white--text"},[e._v("\n                            Удалить клиента\n                            "),n("v-icon",[e._v("mdi-delete")])],1)]):e._e()],1),e._v(" "),e.editMode||1!==e.user.role_id&&3!==e.user.role_id?e._e():n("div",{staticClass:"button-container"},[n("v-btn",{attrs:{block:"",color:"primary"},on:{click:e.showConnectModal}},[e._v("Новая услуга")])],1),e._v(" "),e.editMode||2===e.user.role_id?e._e():n("div",{staticClass:"button-container"},[n("v-btn",{attrs:{block:"",color:"primary"},on:{click:e.showPushModal}},[e._v("Отправить пуш")])],1)]),e._v(" "),2!==e.user.role_id?n("message-modal",{attrs:{state:e.showSendModal,title:"Отправка пуш-уведомления"},on:{sendMessage:e.sendMessage,modalClosed:e.closeModal}}):e._e(),e._v(" "),2!==e.user.role_id?n("ConnectServiceModal",{key:e.connectKey,attrs:{state:e.connectModal},on:{cancel:e.closeConnectModal,connect:e.onConnectModal}}):e._e(),e._v(" "),2!==e.user.role_id?n("ConfirmationModal",{attrs:{state:e.deleteModal,message:"Вы действительно хотите удалить клиента "+e.client.name+"?"},on:{cancel:function(t){e.deleteModal=!1},confirm:e.deleteClient}}):e._e()],1)],1)],1)}),[],!1,null,"3781b043",null).exports);function E(e,t,n,i,o,a,c){try{var s=e[a](c),r=s.value}catch(e){return void n(e)}s.done?t(r):Promise.resolve(r).then(i,o)}var D={data:function(){return{valid:!0,newService:!1,service_id:-1,name:"",price:null}},computed:{getName:function(){var e=this;return this.services.find((function(t){return e.service_id===t.id})).name},services:function(){return this.$store.getters[l.a.TEMP_SERVICES](this.service)}},props:{service:{type:Number,default:0},connection:{type:Number,default:0},state:{type:Boolean,default:!0}},methods:{setPrice:function(){var e=this;-1!==this.service_id&&this.services.length||(this.price=null),this.price=this.services.find((function(t){return e.service_id===t.id})).price},onClose:function(){this.$emit("onClose")},saleService:function(){var e,t=this;return(e=o.a.mark((function e(){var n;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n={name:t.name||t.getName,price:+t.price,connection_id:t.connection,user_id:t.$store.getters.user.id},e.next=3,t.$store.dispatch(u.a.SALE,n);case 3:t.$emit("onSale",{name:n.name,price:t.price});case 4:case"end":return e.stop()}}),e)})),function(){var t=this,n=arguments;return new Promise((function(i,o){var a=e.apply(t,n);function c(e){E(a,i,o,c,s,"next",e)}function s(e){E(a,i,o,c,s,"throw",e)}c(void 0)}))})()}}},I=Object(g.a)(D,(function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("v-dialog",{attrs:{persistent:"","max-width":"700"},model:{value:e.state,callback:function(t){e.state=t},expression:"state"}},[n("v-card",[n("v-card-title",{staticClass:"headline blue darken-1 justify-content-between"},[n("span",{staticClass:"white--text"},[e._v("Подключение разовой услуги")]),e._v(" "),n("v-btn",{staticClass:"float-right",attrs:{icon:"",text:""}},[n("v-icon",{attrs:{color:"white"},on:{click:e.onClose}},[e._v("\n                    mdi-close\n                ")])],1)],1),e._v(" "),n("v-card-text",{staticClass:"pt-5"},[n("v-form",{model:{value:e.valid,callback:function(t){e.valid=t},expression:"valid"}},[e.services.length?n("div",[e.newService?e._e():n("v-select",{attrs:{label:"Разовая услуга",items:e.services,rules:[function(e){return!!e||"Выберите услугу"}],"item-text":"name","item-value":"id"},on:{change:e.setPrice},model:{value:e.service_id,callback:function(t){e.service_id=t},expression:"service_id"}}),e._v(" "),n("v-checkbox",{attrs:{label:"Услуга не из списка"},model:{value:e.newService,callback:function(t){e.newService=t},expression:"newService"}})],1):e._e(),e._v(" "),!e.services.length||e.newService?n("v-text-field",{attrs:{rules:[function(e){return!!e||"Введите наименование услуги"}],label:"Разовая услуга"},model:{value:e.name,callback:function(t){e.name=t},expression:"name"}}):e._e(),e._v(" "),n("v-text-field",{attrs:{type:"number",label:"Стоимость",rules:[function(e){return!!e||"Введите стоимость услуги"}]},model:{value:e.price,callback:function(t){e.price=t},expression:"price"}})],1),e._v(" "),n("v-divider")],1),e._v(" "),n("v-card-actions",[n("v-spacer"),e._v(" "),n("v-btn",{attrs:{text:""},on:{click:e.onClose}},[e._v("Отмена")]),e._v(" "),n("v-btn",{attrs:{text:"",color:"success",disabled:!e.valid},on:{click:e.saleService}},[e._v("\n                Начислить\n                "),n("v-icon",[e._v("mdi-check")])],1)],1)],1)],1)}),[],!1,null,"4bd92d7e",null).exports,T=n("75D1");function N(e,t,n,i,o,a,c){try{var s=e[a](c),r=s.value}catch(e){return void n(e)}s.done?t(r):Promise.resolve(r).then(i,o)}function F(e){return function(){var t=this,n=arguments;return new Promise((function(i,o){var a=e.apply(t,n);function c(e){N(a,i,o,c,s,"next",e)}function s(e){N(a,i,o,c,s,"throw",e)}c(void 0)}))}}var A={components:{ConfirmationModal:a.a},data:function(){return{paymentsSegment:!0,history:null,sum:0,historySegment:!1,totalSum:null,deleteModal:!1,deleteId:null,filter:0,dateFilters:[{text:"За последние полгода",value:0},{text:"За последний год",value:1},{text:"За все время",value:2}]}},computed:{payments:function(){var e=this.history.payments,t=null;return 0===this.filter?(t=r()().subtract(6,"months"),console.log(t),e.filter((function(e){var n=r()(e.created_at);return r()(n).isAfter(r()(t))||r()(n).isSame(r()(t),"day")}))):1===this.filter?(t=r()().subtract(1,"year"),console.log(t),e.filter((function(e){var n=r()(e.created_at);return r()(n).isAfter(r()(t))||r()(n).isSame(r()(t),"day")}))):this.history.payments},transactions:function(){var e=null,t=this.history.transactions;return 0===this.filter?(e=r()().subtract(6,"months"),console.log(e),t.filter((function(t){var n=r()(t.created_at);return r()(n).isAfter(r()(e))||r()(n).isSame(r()(e),"day")}))):1===this.filter?(e=r()().subtract(1,"year"),t.filter((function(t){var n=r()(t.created_at);return r()(n).isAfter(r()(e))||r()(n).isSame(r()(e),"day")}))):this.history.transactions}},filters:{positive:function(e){return e<0?-1*e:e}},props:{state:{type:Boolean,default:!0},connection:{type:Number,default:0}},methods:{showPayments:function(){this.paymentsSegment=!0,this.historySegment=!1},showHistory:function(){this.paymentsSegment=!1,this.historySegment=!0},deleteTransaction:function(){var e=this;return F(o.a.mark((function t(){return o.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,Object(d.f)(e.deleteId);case 2:return t.next=4,e.getClient();case 4:return t.next=6,e.modalInit();case 6:Object(v.a)("Транзакция удалена"),e.deleteModal=!1,e.deleteId=null;case 9:case"end":return t.stop()}}),t)})))()},getClient:function(){var e=this;return F(o.a.mark((function t(){var n;return o.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n=e.$route.params.userId,t.next=3,e.$store.dispatch(u.a.GET_CLIENT,n);case 3:case"end":return t.stop()}}),t)})))()},modalInit:function(){var e=this;return F(o.a.mark((function t(){return o.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!e.connection){t.next=7;break}return t.next=3,Object(d.k)(e.connection);case 3:e.history=t.sent,e.sum=e.history.sum,e.history.payments=e.history.payments.map((function(t){e.sum-t.price>0?t.paid=t.price:t.paid=e.sum,e.sum<=0&&(t.paid=0),e.sum-=t.paid;var n=r()(t.created_at).format("MM");return t.month=T.a[n-1],t})).reverse(),e.history.transactions=e.history.transaction.map((function(e){return e.date=r()(e.created_at).format("DD.MM.YYYY"),e})).reverse();case 7:case"end":return t.stop()}}),t)})))()}},mounted:function(){var e=this;return F(o.a.mark((function t(){return o.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,e.modalInit();case 2:case"end":return t.stop()}}),t)})))()}},B=Object(g.a)(A,(function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("v-dialog",{attrs:{"max-width":"800",persistent:""},model:{value:e.state,callback:function(t){e.state=t},expression:"state"}},[n("v-card",[n("v-card-title",{staticClass:"headline blue darken-1 justify-content-between"},[n("span",{staticClass:"white--text"},[e._v("История баланса")]),e._v(" "),n("v-btn",{staticClass:"float-right",attrs:{icon:"",text:""}},[n("v-icon",{attrs:{color:"white"},on:{click:function(t){return e.$emit("closeModal")}}},[e._v("\n                    mdi-close\n                ")])],1)],1),e._v(" "),n("v-card-text",{staticClass:"pt-2"},[e.history?n("div",[n("v-flex",[n("v-btn",{attrs:{depressed:"",text:!e.paymentsSegment,color:e.paymentsSegment?"primary":"default"},on:{click:e.showPayments}},[e._v("\n                        Начисления\n                    ")]),e._v(" "),n("v-btn",{attrs:{depressed:"",text:!e.historySegment,color:e.history?"primary":"default"},on:{click:e.showHistory}},[e._v("\n                        История\n                    ")])],1),e._v(" "),n("div",{staticClass:"d-flex justify-content-between p-2"},[n("h3",[n("b",[e._v("Лицевой счет: ")]),e._v(" "+e._s(e._f("account_pipe")(this.history.personal_account))+" ")]),e._v(" "),n("div",[n("h4",[e._v("Фильтр")]),e._v(" "),n("v-select",{staticStyle:{"max-width":"250px"},attrs:{items:e.dateFilters,"item-text":"text","item-value":"value"},model:{value:e.filter,callback:function(t){e.filter=t},expression:"filter"}})],1)]),e._v(" "),e.paymentsSegment?n("div",{staticClass:"payments-block p-2"},[n("v-simple-table",{scopedSlots:e._u([{key:"default",fn:function(){return[n("thead",[n("tr",[n("th",[e._v("Начисление")]),e._v(" "),n("th",[e._v("Оплата")])])]),e._v(" "),n("tbody",e._l(e.payments,(function(t){return n("tr",{key:t.id},[n("td",[e._v(e._s(t.month)+"'"+e._s(t.price)+" "),t.sale?n("span",[e._v("("+e._s(t.sale)+")")]):e._e()]),e._v(" "),n("td",[e._v(e._s(t.paid))])])})),0)]},proxy:!0}],null,!1,3115217924)})],1):e._e(),e._v(" "),e.historySegment?n("div",{staticClass:"history-block"},[n("v-simple-table",{scopedSlots:e._u([{key:"default",fn:function(){return[n("thead",[n("tr",[n("th",[e._v("Дата")]),e._v(" "),n("th",[e._v("Тип")]),e._v(" "),n("th",[e._v("Кассир")]),e._v(" "),n("th",[e._v("Сумма")]),e._v(" "),n("th",[e._v("Основание")]),e._v(" "),n("th",[e._v("Действие")])])]),e._v(" "),n("tbody",e._l(e.transactions,(function(t){return n("tr",{key:t.id},[n("td",[e._v(e._s(t.date))]),e._v(" "),n("td",[t.balance<0?n("span",[e._v("Списание")]):n("span",[e._v("Пополнение")])]),e._v(" "),n("td",[e._v(e._s("Администратор"))]),e._v(" "),n("td",[e._v(e._s(e._f("positive")(t.balance)))]),e._v(" "),n("td",[t.sale?n("span",[e._v(e._s(t.sale))]):n("span",[e._v("Абонентская плата")])]),e._v(" "),n("td",[n("v-btn",{attrs:{icon:""},on:{click:function(n){e.deleteModal=!0,e.deleteId=t.id}}},[n("v-icon",[e._v("\n                                            mdi-delete\n                                        ")])],1)],1)])})),0)]},proxy:!0}],null,!1,352818766)})],1):e._e()],1):n("div",{staticClass:"d-flex justify-content-center align-items-center",staticStyle:{"min-height":"400px"}},[n("v-progress-circular",{attrs:{indeterminate:"",size:"65",color:"primary"}})],1)])],1),e._v(" "),n("ConfirmationModal",{attrs:{state:e.deleteModal,message:"Вы действительно хотите удалить выбранную транзакцию?"},on:{cancel:function(t){e.deleteModal=!1,e.deleteId=null},confirm:e.deleteTransaction}})],1)}),[],!1,null,"68b7030f",null).exports;function L(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,i)}return n}function R(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?L(Object(n),!0).forEach((function(t){K(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):L(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function K(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function H(e,t,n,i,o,a,c){try{var s=e[a](c),r=s.value}catch(e){return void n(e)}s.done?t(r):Promise.resolve(r).then(i,o)}function z(e){return function(){var t=this,n=arguments;return new Promise((function(i,o){var a=e.apply(t,n);function c(e){H(a,i,o,c,s,"next",e)}function s(e){H(a,i,o,c,s,"throw",e)}c(void 0)}))}}var U={beforeRouteLeave:function(e,t,n){var i=this;return z(o.a.mark((function e(){return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,i.$store.dispatch(u.a.CLEAR_CLIENT);case 2:n();case 3:case"end":return e.stop()}}),e)})))()},components:{ClientBio:$,ConfirmationModal:a.a,OneTimeServiceModal:I,HistoryModal:B},filters:{accountPipe:function(e){var t=e;t=t.split("");var n="";return t.forEach((function(e,t){n+=e,t%2!=0&&(n+=" ")})),n}},created:function(){var e=this.$route.params.userId;this.$store.dispatch(u.a.GET_CLIENT,e)},computed:{client:function(){return this.$store.getters[l.a.CLIENT]},companies:function(){return this.$store.getters.COMPANIES},subjects:function(){return this.$store.getters.getSubjects},user:function(){return this.$store.getters.user},activeFields:function(){return this.$store.getters.active_fields},mapClient:function(){var e=R({},this.client),t=this.activeFields.map((function(e){return e.alias})),n=[];return e.additional_fields?n=Object.keys(e.additional_fields):e.additional_fields={},t.forEach((function(t,i){n.includes(t)||(e.additional_fields[t]="")})),e}},data:function(){return{service_name:"",tempModalKey:0,editingConnection:null,editConnectionMode:!1,service_id:null,historyModalKey:0,connection_id:null,historyModal:!1,balance:null,oneTimeServiceModal:!1,showConfirmationModal:!1,connectModal:!1,disconnectModal:!1,deleteModal:!1,modalMessage:"",paymentMode:!1,editMode:!1,destroy:!1,message:null}},methods:{showTempServiceModal:function(e){this.oneTimeServiceModal=!0,this.connection_id=e.id,this.service_id=e.service_id},onEdit:function(){this.editMode=!0},onSave:function(e){this.editMode=!1},onSale:function(e){Object(v.a)("Разовая услуга успешно продана!");var t={title:"Внимание",body:'Вами была приобретена услуга "'.concat(e.name,'", стоимостью ').concat(e.price," тг.")};this.sendPush(t),this.oneTimeServiceModal=!1,this.tempModalKey++},triggerBalanceField:function(e){this.client.connections=this.client.connections.map((function(t){return t.id===e.id&&(t.paymentMode=!0),t}))},cancelBalance:function(e){return this.balance=null,this.client.connections=this.client.connections.map((function(t){return t.id===e.id&&(t.paymentMode=!1),t})),0},addBalance:function(e){var t=this;return z(o.a.mark((function n(){return o.a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(!(t.balance<1)){n.next=4;break}return Object(v.a)("Введенное число должно быть больше 0!","","warning"),t.client.connections=t.client.connections.map((function(t){return t.id===e.id&&(t.paymentMode=!1),t})),n.abrupt("return");case 4:return n.next=6,t.$store.dispatch(u.a.ADD_BALANCE,{id:e.id,balance:t.balance,user_id:t.$store.getters.user.id});case 6:return n.next=8,t.sendPush({title:"Внимание!",body:"Ваш баланс пополнен на ".concat(t.balance," тенге!")});case 8:t.balance=null,t.client.connections=t.client.connections.map((function(t){return t.id===e.id&&(t.paymentMode=!1),t}));case 10:case"end":return n.stop()}}),n)})))()},showDisconnectModal:function(e){this.service_name=e.service_name,this.connection_id=e.id,this.showConfirmationModalFunction("Вы действительно хотите отключить выбранную услугу?"),this.disconnectModal=!0},showHistoryModal:function(e){this.connection_id=e.id,this.historyModalKey++,this.historyModal=!0},showDeleteModal:function(e){this.connection_id=e.id,this.showConfirmationModalFunction("Вы действительно хотите удалить выбранную услугу?"),this.deleteModal=!0},showConnectModal:function(e){this.service_name=e.service_name,this.connection_id=e.id,this.showConfirmationModalFunction("Вы действительно хотите подключить выбранную услугу?"),this.connectModal=!0},showPaymentModal:function(e){this.showConfirmationModalFunction("Вы действительно хотите оплатить выбранную услугу?")},showConfirmationModalFunction:function(e){this.modalMessage=e},disconnectService:function(){var e=this;return z(o.a.mark((function t(){return o.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,e.$store.dispatch(u.a.DISCONNECT,e.connection_id);case 2:return t.next=4,e.sendPush({title:"Внимание!",body:"Услуга ".concat(e.service_name," отключена.")});case 4:e.service_name="",e.disconnectModal=!1,e.connection_id=null;case 7:case"end":return t.stop()}}),t)})))()},connectService:function(){var e=this;return z(o.a.mark((function t(){return o.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,e.$store.dispatch(u.a.CONNECT,e.connection_id);case 2:return console.log(e.client),t.next=5,e.sendPush({title:"Внимание!",body:"Вы подключили услугу ".concat(e.service_name,".")});case 5:e.service_name="",e.connectModal=!1,e.connection_id=null;case 8:case"end":return t.stop()}}),t)})))()},deleteService:function(){var e=this;return z(o.a.mark((function t(){return o.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return e.deleteModal=!1,t.next=3,e.$store.dispatch(u.a.DELETE_CONNECTION,e.connection_id);case 3:e.connection_id=null;case 4:case"end":return t.stop()}}),t)})))()},enableEditMode:function(e){var t=this;return z(o.a.mark((function n(){return o.a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:t.editConnectionMode=!0,t.editingConnection=e;case 2:case"end":return n.stop()}}),n)})))()},sendPush:function(e){var t=this;return z(o.a.mark((function n(){var i;return o.a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(t.client.push_token){n.next=2;break}return n.abrupt("return",null);case 2:return i=R(R({},e),{},{client_id:t.client.id,user_id:1}),n.prev=3,n.next=6,Object(p.k)(i);case 6:n.next=11;break;case 8:n.prev=8,n.t0=n.catch(3),console.log(n.t0);case 11:case"end":return n.stop()}}),n,null,[[3,8]])})))()},editConnection:function(){var e=this;return z(o.a.mark((function t(){return o.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,e.$store.dispatch(u.a.EDIT_CONNECTION,{id:e.editingConnection.id,trademark:e.editingConnection.trademark,personal_account:e.editingConnection.personal_account,price:e.editingConnection.price,address:e.editingConnection.address,company_id:e.editingConnection.company_id});case 2:e.editConnectionMode=!1,e.editingConnection=null;case 4:case"end":return t.stop()}}),t)})))()},onEditClick:function(e){var t=this;return z(o.a.mark((function n(){return o.a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:t.editConnectionMode?t.editConnection():t.enableEditMode(e);case 1:case"end":return n.stop()}}),n)})))()}}},Y=(n("HfdP"),Object(g.a)(U,(function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"client-container"},[n("v-card",[n("v-card-title",[e.client?n("span",[e._v("Информация о контрагенте")]):n("span",[e._v("Пожалуйста, подождите...")])]),e._v(" "),n("v-card-text",[e.client?n("div",[n("client-bio",{attrs:{client:e.mapClient,subjects:e.subjects},on:{editToggled:e.onEdit,saveToggled:e.onSave}}),e._v(" "),n("v-col",{attrs:{cols:"12"}},[n("v-simple-table",{scopedSlots:e._u([{key:"default",fn:function(){return[n("thead",[n("tr",[n("th",{staticClass:"text-left"},[e._v("Торговое наименование")]),e._v(" "),n("th",{staticClass:"text-center"},[e._v("Адрес")]),e._v(" "),n("th",{staticClass:"text-center"},[e._v("Тариф")]),e._v(" "),n("th",{staticClass:"text-center"},[e._v("Лицевой счет")]),e._v(" "),n("th",{staticClass:"text-center"},[e._v("Договор")]),e._v(" "),n("th",{staticClass:"text-center"},[e._v("Баланс")]),e._v(" "),1===e.user.role_id||3===e.user.role_id?n("th",{staticClass:"text-center"},[e._v("Действие")]):e._e()])]),e._v(" "),e.client.connections.length?e._e():n("div",{staticClass:"d-flex-align-center justify-content-center p-3 w-100"},[n("h2",[e._v("Нет подключенных услуг")])]),e._v(" "),e.client.connections.length?n("tbody",e._l(e.client.connections,(function(t){return e.editConnectionMode&&e.editingConnection.id!==t.id?e._e():n("tr",{key:t.id,class:{deactivated:!t.is_active}},[n("td",{staticClass:"d-flex justify-content-between",staticStyle:{"padding-top":"5px"}},[e.editConnectionMode&&e.editingConnection.id===t.id?n("v-text-field",{staticStyle:{"padding-top":"0"},model:{value:e.editingConnection.trademark,callback:function(t){e.$set(e.editingConnection,"trademark",t)},expression:"editingConnection.trademark"}}):e._e(),e._v(" "),e.editConnectionMode?e._e():n("span",{staticClass:"mt-2"},[n("span",[e._v(e._s(t.trademark))])]),e._v(" "),2!==e.user.role_id?n("v-menu",{staticClass:"menu",attrs:{transition:"slide-y-transition"},scopedSlots:e._u([{key:"activator",fn:function(t){var i=t.on;return[n("v-btn",e._g({staticClass:"float-left",attrs:{icon:"",text:""}},i),[n("v-icon",[e._v("mdi-dots-vertical")])],1)]}}],null,!0)},[e._v(" "),n("v-list",[1===t.is_active&&4!==e.user.role_id?n("v-list-item",{attrs:{link:""},on:{click:function(n){return e.showDisconnectModal(t)}}},[n("v-list-item-title",{domProps:{textContent:e._s("Отключить")}})],1):e._e(),e._v(" "),0===t.is_active&&4!==e.user.role_id?n("v-list-item",{attrs:{link:""},on:{click:function(n){return e.showConnectModal(t)}}},[n("v-list-item-title",{domProps:{textContent:e._s("Подключить")}})],1):e._e(),e._v(" "),0===t.is_active&&4!==e.user.role_id?n("v-list-item",{attrs:{link:""},on:{click:function(n){return e.showDeleteModal(t)}}},[n("v-list-item-title",{domProps:{textContent:e._s("Удалить")}})],1):e._e(),e._v(" "),n("v-list-item",{attrs:{link:""},on:{click:function(n){return e.showHistoryModal(t)}}},[n("v-list-item-title",{domProps:{textContent:e._s("История")}})],1),e._v(" "),1===t.is_active&&4!==e.user.role_id?n("v-list-item",{attrs:{link:""},on:{click:function(n){return e.showTempServiceModal(t)}}},[n("v-list-item-title",{domProps:{textContent:e._s("Разовые услуги")}})],1):e._e()],1)],1):e._e()],1),e._v(" "),n("td",{staticClass:"text-center"},[e.editConnectionMode&&e.editingConnection.id===t.id?n("v-text-field",{model:{value:e.editingConnection.address,callback:function(t){e.$set(e.editingConnection,"address",t)},expression:"editingConnection.address"}}):e._e(),e._v(" "),e.editConnectionMode?e._e():n("span",[e._v(e._s(t.address))])],1),e._v(" "),n("td",{staticClass:"text-center"},[e.editConnectionMode&&e.editingConnection.id===t.id?n("v-text-field",{model:{value:e.editingConnection.price,callback:function(t){e.$set(e.editingConnection,"price",t)},expression:"editingConnection.price"}}):e._e(),e._v(" "),e.editConnectionMode?e._e():n("span",[e._v(e._s(t.price))])],1),e._v(" "),n("td",{staticClass:"text-center"},[e.editConnectionMode&&e.editingConnection.id===t.id?n("v-text-field",{directives:[{name:"mask",rawName:"v-mask",value:"## ## ##",expression:"'## ## ##'"}],model:{value:e.editingConnection.personal_account,callback:function(t){e.$set(e.editingConnection,"personal_account",t)},expression:"editingConnection.personal_account"}}):e._e(),e._v(" "),e.editConnectionMode?e._e():n("span",[e._v(e._s(e._f("account_pipe")(t.personal_account)))])],1),e._v(" "),n("td",{staticClass:"text-center"},[e.editConnectionMode?n("v-select",{attrs:{label:"Компания",items:e.companies,"item-text":"name","item-value":"id"},model:{value:e.editingConnection.company_id,callback:function(t){e.$set(e.editingConnection,"company_id",t)},expression:"editingConnection.company_id"}}):e._e(),e._v(" "),e.editConnectionMode?e._e():n("span",[e._v(e._s(t.company.name))])],1),e._v(" "),n("td",{staticClass:"text-center"},[t.paymentMode?n("v-text-field",{directives:[{name:"mask",rawName:"v-mask",value:"########",expression:"'########'"}],ref:"balanceInput",refInFor:!0,attrs:{autofocus:"",type:"number"},on:{keypress:function(n){return!n.type.indexOf("key")&&e._k(n.keyCode,"enter",13,n.key,"Enter")?null:e.addBalance(t)}},model:{value:e.balance,callback:function(t){e.balance=t},expression:"balance"}}):n("span",[e._v(e._s(t.balance))])],1),e._v(" "),1===e.user.role_id||3===e.user.role_id?n("td",{staticClass:"text-center d-flex align-items-center justify-content-center"},[e.editConnectionMode?e._e():n("div",[t.paymentMode?n("div",[n("v-btn",{attrs:{icon:""},on:{click:function(n){return e.cancelBalance(t)}}},[n("v-icon",[e._v("mdi-close")])],1),e._v(" "),n("v-btn",{attrs:{color:"primary",disabled:!t.is_active},on:{click:function(n){return e.addBalance(t)}}},[e._v("\n                                                Оплатить услугу\n                                            ")])],1):n("v-btn",{attrs:{color:"primary",disabled:!t.is_active},on:{click:function(n){return e.triggerBalanceField(t)}}},[e._v("\n                                            Оплатить услугу\n                                        ")])],1),e._v(" "),n("v-btn",{staticClass:"ml-1",attrs:{icon:"",disabled:!t.is_active},on:{click:function(n){return e.onEditClick(t)}}},[e.editConnectionMode?n("v-icon",[e._v("mdi-check")]):n("v-icon",[e._v("mdi-pencil")])],1)],1):e._e()])})),0):e._e()]},proxy:!0}])})],1)],1):n("div",{staticClass:"text-center d-flex align-items-center justify-content-center",staticStyle:{"min-height":"500px"}},[n("v-progress-circular",{attrs:{indeterminate:"",size:"65",color:"primary"}})],1)]),e._v(" "),2!==e.user.role_id?n("ConfirmationModal",{attrs:{message:e.modalMessage,state:e.connectModal},on:{cancel:function(t){e.connectModal=!1},confirm:e.connectService}}):e._e(),e._v(" "),2!==e.user.role_id?n("ConfirmationModal",{attrs:{message:e.modalMessage,state:e.disconnectModal},on:{cancel:function(t){e.disconnectModal=!1},confirm:e.disconnectService}}):e._e(),e._v(" "),2!==e.user.role_id?n("ConfirmationModal",{attrs:{message:e.modalMessage,state:e.deleteModal},on:{confirm:e.deleteService,cancel:function(t){e.deleteModal=!1}}}):e._e(),e._v(" "),2!==e.user.role_id?n("OneTimeServiceModal",{key:e.tempModalKey+78797897,attrs:{service:e.service_id,connection:e.connection_id,state:e.oneTimeServiceModal},on:{onSale:e.onSale,onClose:function(t){e.oneTimeServiceModal=!1,e.tempModalKey++}}}):e._e(),e._v(" "),2!==e.user.role_id?n("HistoryModal",{key:e.historyModalKey,attrs:{connection:e.connection_id,state:e.historyModal},on:{closeModal:function(t){e.historyModal=!1}}}):e._e()],1)],1)}),[],!1,null,"77fd0896",null));t.default=Y.exports},bjyY:function(e,t,n){var i=n("E1z0");"string"==typeof i&&(i=[[e.i,i,""]]);var o={hmr:!0,transform:void 0,insertInto:void 0};n("aET+")(i,o);i.locals&&(e.exports=i.locals)},dXLZ:function(e,t,n){"use strict";n("F3ox")},"f1/F":function(e,t,n){"use strict";n("L8FV")},nSvg:function(e,t,n){(e.exports=n("I1BE")(!1)).push([e.i,".client-container[data-v-77fd0896]{margin-top:50px}p[data-v-77fd0896]{font-size:16px}.button-container[data-v-77fd0896]{margin:10px;max-width:300px}tr.deactivated[data-v-77fd0896]{background-color:rgba(255,130,130,.69)}.d-flex[data-v-77fd0896]{padding:10px}.subject__select[data-v-77fd0896]{padding-top:0!important;margin-top:-2px!important;margin-left:10px}.change-photo[data-v-77fd0896]{margin-top:15px}td[data-v-77fd0896]{min-height:50px}",""])},ootA:function(e,t,n){"use strict";n.d(t,"a",(function(){return l})),n.d(t,"b",(function(){return u}));var i=n("o0o1"),o=n.n(i),a=n("vDqi"),c=n.n(a);function s(e,t,n,i,o,a,c){try{var s=e[a](c),r=s.value}catch(e){return void n(e)}s.done?t(r):Promise.resolve(r).then(i,o)}function r(e){return function(){var t=this,n=arguments;return new Promise((function(i,o){var a=e.apply(t,n);function c(e){s(a,i,o,c,r,"next",e)}function r(e){s(a,i,o,c,r,"throw",e)}c(void 0)}))}}function l(e){return d.apply(this,arguments)}function d(){return(d=r(o.a.mark((function e(t){var n,i,a,s=arguments;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=s.length>1&&void 0!==s[1]?s[1]:"file",(i=new FormData).append(n,t),a={headers:{"content-type":"multipart/form-data"}},e.next=6,c.a.post("/api/upload",i,a);case 6:return e.abrupt("return",e.sent);case 7:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function u(e){return v.apply(this,arguments)}function v(){return(v=r(o.a.mark((function e(t){var n;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return(n=new FormData).append("file",t),e.next=4,c.a.post("/api/delete",n);case 4:return e.abrupt("return",e.sent);case 5:case"end":return e.stop()}}),e)})))).apply(this,arguments)}},toHN:function(e,t,n){(e.exports=n("I1BE")(!1)).push([e.i,".modal-text[data-v-2adaa561]{margin-top:15px!important;font-size:16px}",""])},vsCU:function(e,t,n){"use strict";n("bjyY")}}]);